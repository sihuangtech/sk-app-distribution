# 彩旗软件分发平台

这是一个基于现代Web技术栈构建的软件分发平台，为开发者提供便捷的应用包上传、管理和分发服务。平台支持多种操作系统和架构的安装包管理，并提供安全的用户认证和文件下载服务。

## 技术栈

### 后端技术
- **Node.js** - 运行时环境
- **Express.js** - Web应用框架
- **TypeScript** - 类型安全的JavaScript超集
- **Multer** - 文件上传中间件
- **jsonwebtoken** - JWT身份认证
- **js-yaml** - YAML配置文件解析
- **CORS** - 跨域资源共享支持

### 前端技术
- **React 18** - 用户界面库
- **TypeScript** - 类型安全开发
- **React Router** - 单页应用路由管理
- **Vite** - 现代化构建工具和开发服务器
- **CSS3** - 现代化样式设计

### 开发工具
- **ES6 Modules** - 现代模块系统
- **PM2** - 生产环境进程管理
- **Nginx** - 反向代理和静态文件服务

## 核心功能

- 🔐 **JWT身份认证** - 安全的用户登录和会话管理
- 📁 **应用管理** - 创建、查看和管理应用项目
- ⬆️ **文件上传** - 支持多种格式的安装包上传
- 📋 **文件列表** - 查看和管理已上传的文件
- 🔗 **下载链接** - 自动生成安全的下载链接
- 🎨 **现代化UI** - 响应式设计，支持多设备访问
- ⚙️ **配置化部署** - 通过YAML文件统一管理配置
- 🚀 **生产就绪** - 支持PM2和Nginx生产环境部署

## 项目结构

- `server.ts`: 后端 Express 服务器，处理文件上传和下载。
- `index.html`: 前端应用的入口文件。
- `src/main.tsx`: React 应用的主入口。
- `src/App.tsx`: 包含主应用界面的 React 组件。
- `src/components/`: React 组件目录。
- `uploads/`: 上传的文件将存储在此目录。
- `config.yaml`: **配置文件，包含管理员账号和系统设置（必须配置）**。
- `vite.config.ts`: Vite配置文件，自动从config.yaml读取前端端口。

## 开发环境准备

请确保你已经安装了 Node.js 和 npm。

## 安装依赖

在项目根目录下运行以下命令安装所有依赖：

```bash
npm install
```

## 配置设置

在运行项目前，请先配置 `config.yaml` 文件。所有端口配置都在此文件中统一管理：

```yaml
# 服务器端口配置
server:
  backend_port: 4009  # 后端API端口
  frontend_port: 3009 # 前端开发服务器端口

admin:
  username: your_admin_username # 请替换为你的管理员用户名
  password: your_admin_password # 请替换为你的管理员密码
  sessionDuration: 30 # 登录有效期（天数）

jwt:
  secret: your_jwt_secret_key_here # 请替换为你的JWT密钥
```

**⚠️ 重要：在运行项目前，必须先配置 `config.yaml` 文件。所有端口配置都在此文件中统一管理，代码中不包含任何硬编码端口：**

**重要说明**：
- ✅ **前后端端口完全从 `config.yaml` 文件读取，代码中无任何硬编码端口**
- ✅ **前端通过Vite代理自动转发API请求到后端端口**
- ✅ **生产环境和开发环境统一使用相对路径**
- ✅ **修改端口只需更新配置文件，无需修改代码**
- ❌ **如果配置文件缺失或格式错误，服务器将拒绝启动**

## 运行项目

你需要分别启动后端服务器和前端开发服务器。

1.  **启动后端服务器：**

    在项目根目录下运行：

    ```bash
npm start
    ```

    服务器将运行在配置文件中指定的 `backend_port`。

2.  **启动前端开发服务器：**

    在项目根目录下运行：

    ```bash
npm run frontend-dev
    ```

    前端应用将运行在配置文件中指定的 `frontend_port`。

3.  **同时启动前后端（推荐）：**

    ```bash
npm run dev
    ```

    这将同时启动后端服务器和前端开发服务器，端口均从配置文件读取。

## 功能说明

- **用户登录：** 开发者需要使用配置的管理员账号登录才能使用平台。
- **应用管理：** 可以创建、查看和管理应用，每个应用可以有多个版本的安装包。
- **文件上传：** 登录后可以通过上传页面选择应用并上传安装包。
- **文件管理：** 查看已上传的应用列表，包含下载链接。
- **会话管理：** 登录状态有效期为配置的天数（默认30天）。
- **动态配置：** 前端通过代理自动连接后端，无需硬编码端口。

## 页面导航

- **上传应用**：文件上传界面，支持新建应用和选择现有应用上传文件
- **已上传应用**：查看和管理已上传的文件列表

## 应用管理

### 新建应用
1. 在上传页面点击"新建应用"按钮
2. 填写应用信息：
   - **应用名称**：用于内部标识，只能包含字母、数字、下划线和连字符
   - **显示名称**：用户看到的应用名称
   - **应用描述**：可选，简要描述应用功能
3. 点击"创建应用"完成创建

### 应用数据存储
- 应用信息存储在 `data/apps.json` 文件中
- 支持应用的增删查改操作
- 每个应用包含唯一ID、名称、显示名称、描述和创建时间

## 注意事项

- 当前的文件下载是直接通过文件名访问，实际应用中可能需要更安全的下载方式和链接管理。
- 请确保在生产环境中使用强密码并定期更换。
- 建议在生产环境中使用 HTTPS 协议。
- **所有端口配置统一在 `config.yaml` 中管理，修改端口只需更新配置文件。**
- **代码中不包含任何硬编码端口，确保配置的灵活性和安全性。**

## 项目部署

详细的部署指南请参考：[部署文档](docs/deployment.md) 